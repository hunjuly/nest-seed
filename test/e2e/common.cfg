HOST="http://${PROJECT_NAME}:3000"

CURL() {
    METHOD=$1
    ENDPOINT=$2
    shift 2

    response=$(curl -s -w "%{http_code}" -X $METHOD $HOST$ENDPOINT "$@")
    status="${response:${#response}-3}" # ÎßàÏßÄÎßâ 3ÏûêÎ¶¨Í∞Ä ÏùëÎãµ ÏΩîÎìú
    body="${response:0:${#response}-3}" # ÏùëÎãµ ÏΩîÎìúÎ•º Ï†úÏô∏Ìïú Î≥∏Î¨∏

    if [[ "$status" -ge 300 ]]; then
        echo -e "\e[1;31m$status\e[0m \e[1;35m$METHOD\e[0m \e[1;36m$HOST$ENDPOINT\e[0m" >&2
        echo "$body" | jq '.' >&2
        echo "" >&2
    else
        echo -e "\e[1;32m$status\e[0m \e[1;35m$METHOD\e[0m \e[1;36m$HOST$ENDPOINT\e[0m" >&2
        echo "$body" | jq '.' >&2
        echo "" >&2
        echo "$body"
    fi
}

POST() {
    CURL POST "$@"
}

GET() {
    CURL GET "$@"
}

DELETE() {
    CURL DELETE "$@"
}

PATCH() {
    CURL PATCH "$@"
}

PUT() {
    CURL PUT "$@"
}

reset_all() {
    clear
    echo "üöÄ Starting infra..."
    echo "$(bash ../../scripts/infra_up.sh)"
    echo "$(bash ../../scripts/run_container.sh)"
    echo ""
}

create_user_and_login() {
    echo "ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±"
    res=$(
        POST /users \
            -H 'Content-Type: application/json' \
            -d '{
                "email": "test@test.com",
                "password": "testpassword",
                "birthdate": "1990-01-01",
                "username": "UserName#1",
                "firstName": "FirstName#1",
                "lastName": "LastName#1"
            }'
    )

    USER_ID=$(echo $res | jq -r '.id')

    echo "Î°úÍ∑∏Ïù∏"
    res=$(
        POST /auth/login \
            -H 'Content-Type: application/json' \
            -d '{
                "email": "test@test.com",
                "password": "testpassword"
            }'
    )

    ACCESS_TOKEN=$(echo $res | jq -r '.accessToken')
    REFRESH_TOKEN=$(echo $res | jq -r '.refreshToken')
}
